<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>BRÚJULA - Itinerario</title>

    <meta name="author" content="Lu-Isa" />
    <meta name="description" content="Explorá itinerarios sugeridos y administrá tus reservas guardadas en BRÚJULA." />
    <meta name="keywords" content="itinerarios, turismo, viajes, reservas, destinos" />

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="imagenes/favicon.png" />

    <!-- Tipografías e íconos -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <link rel="stylesheet" href="estilos.css" />
  </head>

<body class="page-itinerario">
  <header class="site-header">
  <div class="wrap header-grid">
    <a class="brand" href="index.html" aria-label="Volver al inicio">
      <img src="imagenes/logo.png" alt="Logo de BRÚJULA" width="40" height="40" />
      <div class="brand-text">
        <h1 class="brand-title">BRÚJULA</h1>
        <span class="brand-sub">Agencia de viajes</span>
      </div>
    </a>

    <!-- Menú -->
    <div class="menu-wrapper" id="menuWrapper">
      <button id="btnMenu" class="btn-hamb" type="button"
              aria-label="Abrir menú" aria-controls="panelMenu" aria-expanded="false">
        <span class="material-symbols-outlined" aria-hidden="true">menu</span>
      </button>

      <nav id="panelMenu" class="panel-menu" aria-label="Menú principal">
        <ul class="menu-list">
          <li><a href="index.html"><span class="material-symbols-outlined" aria-hidden="true">home</span> INICIO</a></li>
          <li><a href="destinos.html"><span class="material-symbols-outlined" aria-hidden="true">map</span> DESTINOS</a></li>
          <li><a href="itinerario.html"><span class="material-symbols-outlined" aria-hidden="true">calendar_add_on</span> ITINERARIO</a></li>
          <li><a href="contacto.html"><span class="material-symbols-outlined" aria-hidden="true">contact_page</span> CONTACTO</a></li>
        </ul>
      </nav>
    </div>
  </div>
</header>

    <main id="main">
      <!-- ===== Encabezado ===== -->
      <section class="wrap itinerario-head">
        <header>
          <h1 class="page-title">ITINERARIO</h1>
          <p class="page-sub">Tus reservas guardadas y recorridos sugeridos.</p>
        </header>
      </section>

      <!-- ===== LISTA EN TARJETAS ===== -->
      <section class="wrap" aria-label="Mis reservas">
        <div class="itinerario-cards">

          <!-- Estado vacío -->
          <p id="res-empty" class="notice mb-10" hidden>
            Aún no agregaste reservas. Abrí Destinos, elegí un lugar, y en el modal usá <em>Calcular costo</em> → Guardar en Itinerario.
          </p>

          <!-- Contenedor de tarjetas -->
          <section id="lista-itinerario" class="lista-itinerario" aria-live="polite"></section>

          <!-- Acciones globales (solo si hay detalles abiertos) -->
          <div id="acciones-globales" class="acciones-globales" hidden>
            <button type="button" id="btnVaciarRes" class="btn btn-sec">VACIAR ITINERARIO</button>
          </div>
        </div>
      </section>
    </main>

    <!-- ===== FOOTER ===== -->
    <footer class="site-footer">
      <div class="wrap">
        <p>&copy; <span id="anio">2025</span> BRÚJULA – Agencia de viajes</p>
      </div>
    </footer>

    <!-- Script de render para tarjetas con mapa y detalles -->
    <script>
      // ==== Configuración ====
      const STORAGE_KEY = "itinerario"; // si usás otra clave, cambiala aquí
      const $lista = document.getElementById("lista-itinerario");
      const $vacio = document.getElementById("res-empty");
      const $acciones = document.getElementById("acciones-globales");
      const $btnVaciar = document.getElementById("btnVaciarRes");

      const toUSD = (n) => `USD ${Number(n || 0).toLocaleString("en-US")}`;
      const srcMapa = (dest) => `https://www.google.com/maps?q=${encodeURIComponent(dest || "")}&output=embed`;

      function leerData() {
        try {
          const arr = JSON.parse(localStorage.getItem(STORAGE_KEY));
          return Array.isArray(arr) ? arr : [];
        } catch {
          return [];
        }
      }

      function guardarData(arr) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(arr || []));
      }

      function calcularTotal(item) {
        const dias = Number(item.dias ?? item.Dias ?? 0);
        const usdDia = Number(item.usdDia ?? item.precioDia ?? item.usd ?? 0);
        return dias * usdDia;
      }

      function render() {
        const data = leerData();
        $lista.innerHTML = "";

        if (data.length === 0) {
          $vacio.hidden = false;
          $acciones.hidden = true;
          return;
        }
        $vacio.hidden = true;

        data.forEach((item, idx) => {
          const destino = item.destino ?? item.Destino ?? "Destino";
          const fecha = item.fecha ?? item.Fecha ?? "—";
          const dias = item.dias ?? item.Dias ?? "—";
          const usdDia = item.usdDia ?? item.precioDia ?? item.usd ?? "—";
          const total = calcularTotal(item);

          const art = document.createElement("article");
          art.className = "it-card";
          art.innerHTML = `
            <div class="it-card-body">
              <h3 class="it-card-titulo">${destino}</h3>
              <p class="it-card-linea"><strong>DESTINO:</strong> ${destino}</p>
              <p class="it-card-linea"><strong>FECHA:</strong> ${fecha}</p>
              <button class="btn btn-detalles" data-idx="${idx}">DETALLES</button>

              <div class="it-card-detalles" hidden>
                <div class="det-grid">
                  <div><span>DÍAS</span><strong>${dias}</strong></div>
                  <div><span>USD/día</span><strong>${toUSD(usdDia)}</strong></div>
                  <div><span>Total</span><strong>${toUSD(total)}</strong></div>
                </div>
                <div class="det-acciones">
                  <button class="btn btn-sec" data-eliminar="${idx}">ELIMINAR</button>
                </div>
              </div>
            </div>

            <div class="it-card-media">
              <iframe class="it-mapa" loading="lazy" referrerpolicy="no-referrer-when-downgrade"
                src="${srcMapa(destino)}" aria-label="Mapa ${destino}"></iframe>
            </div>
          `;
          $lista.appendChild(art);
        });

        // listeners
        $lista.querySelectorAll(".btn-detalles").forEach((b) => {
          b.onclick = (e) => {
            const card = e.currentTarget.closest(".it-card");
            const panel = card.querySelector(".it-card-detalles");
            const abierto = panel.hidden === false;
            panel.hidden = abierto;
            card.classList.toggle("open", !abierto);

            const algunoAbierto = [...document.querySelectorAll(".it-card-detalles")].some((p) => p.hidden === false);
            $acciones.hidden = !algunoAbierto;
          };
        });

        $lista.querySelectorAll("[data-eliminar]").forEach((b) => {
          b.onclick = (e) => {
            const i = Number(e.currentTarget.getAttribute("data-eliminar"));
            const data = leerData();
            data.splice(i, 1);
            guardarData(data);
            render();
          };
        });

        $btnVaciar.onclick = () => {
          if (confirm("¿Vaciar itinerario?")) {
            guardarData([]);
            render();
          }
        };
      }

      document.addEventListener("DOMContentLoaded", render);
    </script>
    <script src="script.js" defer></script>

  </body>
</html>
